<!DOCTYPE html>
<html>
    <head>
<meta charset="utf-8" />
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

<script src='https://api.tiles.mapbox.com/mapbox.js/v2.0.1/mapbox.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox.js/v2.0.1/mapbox.css' rel='stylesheet' />
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="//d79i1fxsrar4t.cloudfront.net/jquery.liveaddress/2.4/jquery.liveaddress.min.js"></script> 
<!-- <script src="mylive.js"></script> 
 -->


<title> Marillac: Helping pantry managers find other pantries for their clients</title> 
    </head>
  <body>
  <style>
 /* HACKY CODE FROM https://github.com/smartystreets/jquery.liveaddress/blob/master/index.html */  

#themap {
  width: 100%; height: 600px; 
  position:absolute;
}

  form {
    width: 300px;
    margin-right: 25px;
    margin-bottom: 25px;
    float: left;
    position: relative;
  }

  form header {
    padding: 10px 50px 0;
    background: #F0F0F0;
  }


  form header h3 {
    font-weight: 300;
    font-size: 27px;
    margin: 0;
    padding-bottom: 10px;
  }

  form table {
    margin: 15px 10px;
    font-size: 14px;
  }

  form table td {
    padding: 2px;
  }

  form input[type=text],
  form textarea {
    padding: 5px 5px 3px;
    font: 12px/1em sans-serif;
    width: 160px;
    outline: none;
  }

  form select {
    outline: none;
  }

  form textarea {
    min-height: 40px;
  }

  form input[type=submit],
  form [type=image],
  form button {
    font-size: 13px;
  }

.filter-ui {
  background:#fff;
  position:absolute;
  top:10px;
  right:10px;
  z-index:100;
  padding:10px;
  border-radius:3px;
  }

</style>

<nav id='filters' class='filter-ui'>Select: </nav>
<div id="themap"></div>

 <form id="happyPath">
    <header>
      <h3>Input Address</h3> </header>
    <table>
      <tr>
        <td>Street address:</td>
        <td><input type="text" name="street"></td>
      </tr>
      <tr>
        <td>City:</td>
        <td><input type="text" name="city"></td>
      </tr>
      <tr>
        <td>State:</td>
        <td><input type="text" name="state"></td>
      </tr>
      <tr>
        <td>ZIP Code:</td>
        <td><input type="text" name="zip"></td>
      </tr>
      <tr>
        <td></td>
        <td><input type="submit" value="Find Address"></td>
      </tr>
    </table>
  </form>
 
</div>


 

<script> 

// begin mapbox code    

L.mapbox.accessToken = 'pk.eyJ1Ijoic2tvcmFzYXVydXMiLCJhIjoiaEdGTUZWTSJ9.osOC8tWU3bMaNprVNoEu7g'; 

var filters = document.getElementById('filters');

var mizzap = L.mapbox.map('themap', 'skorasaurus.jcedc433')
    .setView([41.500880,-81.694036], 12);
               
              // https://www.mapbox.com/foundations/building-a-store-locator/
              // initializes feature layer for use later: 
              // https://github.com/maptime/maptime-bites/blob/gh-pages/00004/index.html
               var featLayer = L.mapbox.featureLayer().addTo(mizzap);

featLayer.loadURL('places.geojson'); 


featLayer.on('ready', function() {
function turnOnPopups() { 
     featLayer.eachLayer(function(polygon) { 
      polygon.bindPopup('Name: ' + polygon.feature.properties.name + '<br \/>' + 
        'Kind: ' + polygon.feature.properties.kind + '<br \/>' + 
        'When: ' + polygon.feature.properties.when + '<br \/>' + 
        'Open to: ' + polygon.feature.properties.forwhom + '<br \/>' + 
        'Address: ' + polygon.feature.properties.address + '<br \/>' + 
        'Phone: ' + polygon.feature.properties.call ); 
         }); 

}
turnOnPopups();
// adapted from: https://www.mapbox.com/mapbox.js/example/v1.0.0/multiple-marker-filters/
// i'm using kind as the filter
 var typesObj = {}, types = [];
  var features = featLayer.getGeoJSON().features;
  for (var i = 0; i < features.length; i++) {
    typesObj[features[i].properties['kind']] = true;
  }
  for (var k in typesObj) types.push(k);

  var checkboxes = [];
  // Create a filter interface.
  for (var i = 0; i < types.length; i++) {
    // Create an an input checkbox and label inside.
    var item = filters.appendChild(document.createElement('div'));
    var checkbox = item.appendChild(document.createElement('input'));
    var label = item.appendChild(document.createElement('label'));
    checkbox.type = 'checkbox';
    checkbox.id = types[i];
    checkbox.checked = true;
    // create a label to the right of the checkbox with explanatory text
    label.innerHTML = types[i];
    label.setAttribute('for', types[i]);
    // Whenever a person clicks on this checkbox, call the update().
    checkbox.addEventListener('change', update);
    checkboxes.push(checkbox);
  }

  // This function is called whenever someone clicks on a checkbox and changes
  // the selection of markers to be displayed.
  function update() {
    var enabled = {};
    // Run through each checkbox and record whether it is checked. If it is,
    // add it to the object of types to display, otherwise do not.
    for (var i = 0; i < checkboxes.length; i++) {
      if (checkboxes[i].checked) enabled[checkboxes[i].id] = true;
    }
    featLayer.setFilter(function(feature) {
      // If this symbol is in the list, return true. if not, return false.
      // The 'in' operator in javascript does exactly that: given a string
      // or number, it says if that is in a object.
      // 2 in { 2: true } // true
      // 2 in { } // false
      return (feature.properties['kind'] in enabled);
      
    });
    turnOnPopups();
  }

});   


/** CONFIGURE smartystreets **/

    var htmlKey = "3548360835619230092";      // Put your HTML key here
    var debug = false;          // Toggle debug mode

    var testRunnerVersion = "1.1.6";  // The version of this test runner page


    /** PREPARE FORM(S) **/
    
    $(function()
    {
      $('form#submitEvent').submit(function() {
        alert("Form submit. Verification should happen first (if necessary), then this should occur.");
      });
    });


    /** INITIALIZE liveaddress **/

    var liveaddress = $.LiveAddress({
      key: htmlKey,   // An HTML key from your account
      debug: debug,   // Show debug stuff
      cityStatePreference: "Cleveland, OH", // prefer Cle cities
      stateFilter: "OH" // only autcomplete ohio
    });

    // https://github.com/smartystreets/jquery.liveaddress/blob/master/customizations/get-coordinates.js
    //grab coordinates and then pan to the coords,     
    liveaddress.on("AddressAccepted", function(event, data, previousHandler)
    {
    if (data.response.chosen)
    console.log(data.response.chosen.metadata.latitude, data.response.chosen.metadata.longitude);
  // create marker based on the returned coords, add it to map
    L.marker([data.response.chosen.metadata.latitude, data.response.chosen.metadata.longitude], {
      icon: L.mapbox.marker.icon({
          'marker-size': 'medium',
          'marker-symbol': 'star',
          'marker-color': '#fa0'
      })
    }).addTo(mizzap);
    // change map to zoom on the returned coords
    mizzap.setView([data.response.chosen.metadata.latitude, data.response.chosen.metadata.longitude], 14);
    previousHandler(event, data);
    });

</script>

<script>
function suppress(event) {
  if (!event) return false;
  if (event.preventDefault) event.preventDefault();
  if (event.stopPropagation) event.stopPropagation();
  if (event.stopImmediatePropagation) event.stopImmediatePropagation();
  if (event.cancelBubble) event.cancelBubble = true;
  return false;
}
</script>

  </body>
</html>